  <!DOCTYPE html class="htmldoc">
  <html class="animate.contents">
  <head>
    <title>Restaurant Finder</title>
  <link rel="stylesheet" href="style.css" type="text/css">
  </head>
  <body>
    
    <div class="transition transition-1 is-active"></div>
    <!-- Heading for the website -->
    <div class="header">
      <p> <a href="index.html"><img src="house-icon-png-white-32.png" alt="Home"></h1></a></p>
      <h1>Restaurant Finder</h1>
      <h3 class="support-header"><a href="Support.html">Support</a></h3>
    </div>
    <!-- container to hold the content -->
    <div class="container">
      <!-- Map container -->
      <div id="map"></div>
      <!-- Search box for places autocomplete -->
      <div class="search-bar">
        <input id="placesSearchInput" type="text" placeholder="Search for a place">
        <!-- Search filters -->
        <div>
          <label for="cuisineType">Cuisine Type:</label>
          <select id="cuisineType">
            <option value="all">All Cuisines</option>
            <option value="italian">Italian</option>
            <option value="mexican">Mexican</option>
            <!-- Add more cuisine options as needed -->
          </select>
        </div>
        <div>
          <input type="checkbox" id="openNow" />
          <label for="openNow">Open Now</label>
        </div>
        <div>
          <label for="ratingRange">Minimum Rating:</label>
          <input type="range" id="ratingRange" min="1" max="5" step="1" value="0" />
        </div>
        <div>
          <label for="priceRange">Price Range:</label>
          <input type="range" id="priceRange" min="1" max="4" value="1" />
        </div>
        <!-- Button to find user's location -->
        <button id="findLocationButton">Find My Location</button>
      </div>
    </div>
    <div class="Botttom-header">
      <H3>Support</H1>
      <h3>Contact: .......@gmail.com</h3>
      <h3>Phone: 027 000 0000</h3>
      <h3 class="Decorationless"><a href="Feedback.html">Feedback</a></h3>

    </div>

    <!-- JavaScript code for map and restaurant search functionality. -->
    <script>
      let map;
      let searchBox;
      let markers = [];

      fetch['rhrrhrh']

      // initialize the map and search for restaurants.
      function initMap() {
        // check if geolocation is supported by the browser.
        if (navigator.geolocation) {
          // Get the user's current position
          navigator.geolocation.getCurrentPosition(function(position) {
            // Storing the user's location in latitude and longitude.
            const userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            // Create a new map centered at the user's location
            map = new google.maps.Map(document.getElementById("map"), {
              center: userLocation,
              zoom: 14
            });

            // Create a search box and link it to the UI element
            const placesSearchInput = document.getElementById("placesSearchInput");
            searchBox = new google.maps.places.SearchBox(placesSearchInput);

            // Bias the search box to the map's viewport
            map.addListener("bounds_changed", function() {
              searchBox.setBounds(map.getBounds());
            });

            // Listen for the event when the user selects a prediction from the search box
            searchBox.addListener("places_changed", function() {
              const places = searchBox.getPlaces();

              if (places.length === 0) {
                return;
              }

              // Clear previous markers
              clearMarkers();

              // For each place, create a marker and set the map's center to the first result
              const bounds = new google.maps.LatLngBounds();
              places.forEach(function(place) {
                if (!place.geometry) {
                  console.log("Returned place contains no geometry");
                  return;
                }

                // Create a marker for the place
                createMarker(place, map);

                if (place.geometry.viewport) {
                  bounds.union(place.geometry.viewport);
                } else {
                  bounds.extend(place.geometry.location);
                }
              });

              // Set the map's center and zoom to fit all markers and selected place
              map.fitBounds(bounds);

              // Search for nearby restaurants at the selected location
              searchRestaurants(bounds.getCenter());
            });

            // Find user's location and search for nearby restaurants when the button is clicked
            const findLocationButton = document.getElementById("findLocationButton");
            findLocationButton.addEventListener("click", function() {
              getUserLocation();
            });

            // Search for nearby restaurants on the map
            searchRestaurants(userLocation);
          });
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      }

      // Get user's location using browser-based geolocation
      function getUserLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            const userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            map.setCenter(userLocation);
            clearMarkers();
            searchRestaurants(userLocation);
          });
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      }

      // Modify the searchRestaurants function to include search filters
      function searchRestaurants(location) {
        // Get the selected values of the search filters
        const cuisineType = document.getElementById("cuisineType").value;
        const openNow = document.getElementById("openNow").checked;
        const minRating = parseFloat(document.getElementById("ratingRange").value);
        const maxPriceLevel = parseInt(document.getElementById("priceRange").value);

        // Create a PlacesService object
        const service = new google.maps.places.PlacesService(map);

        // Define the search request with the selected filters
        const request = {
          location: location,
          radius: 5000, // Adjust the search radius as desired
          types: ["restaurant"], // Filter for restaurants only
        };

        // Add filters to the search request based on the selected values
        if (cuisineType !== "all") {
          request.keyword = cuisineType;
        }
        if (openNow) {
          request.openNow = true;
        }

        // Send the search request and process the results
        service.nearbySearch(request, function(results, status) {
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            // Filter the results based on rating and price range
            const filteredResults = results.filter(
              (place) =>
                place.rating >= minRating && (!place.price_level || place.price_level <= maxPriceLevel)
            );

            // Create markers for each restaurant found
            clearMarkers();
            for (let i = 0; i < filteredResults.length; i++) {
              createMarker(filteredResults[i], map);
            }
          }
        });
      }

      // Function to create a marker for each place
      function createMarker(place, map) {
        const marker = new google.maps.Marker({
          position: place.geometry.location,
          map: map,
          title: place.name,
        });

        // Add marker to the markers array
        markers.push(marker);

        // Attach a click event to the marker to show distance and route
        marker.addListener("click", function() {
          const destination = place.geometry.location;
          showDistanceAndRoute(destination);
        });
      }

      // Function to show distance and route between user's location and a restaurant
      function showDistanceAndRoute(destination) {
        // Get the user's current location
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            const userLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            const distance = google.maps.geometry.spherical.computeDistanceBetween(userLocation, destination);
            const distanceInKm = (distance / 1000).toFixed(2); // Convert distance to kilometers and round to 2 decimal places

            // Show the distance
            window.alert(`Distance to ${place.name}: ${distanceInKm} km`);

            // Show route on the map
            showRoute(destination);
          });
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      }

      // Function to clear all markers from the map
      function clearMarkers() {
        // Loop through all the markers and set the map to null
        for (let i = 0; i < markers.length; i++) {
          markers[i].setMap(null);
        }

        // Clear the markers array
        markers = [];
      }

      // Load the Google Maps JavaScript API with the Places library
      function loadGoogleMapsScript() {
        const script = document.createElement("script");
        script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyBxgFm8A0qnrxYKkvbQHCfF9WWBBS_SyjI&libraries=places&callback=initMap";
        script.defer = true;
        script.async = true;
        document.body.appendChild(script);
      }

      // Call the function to load the Google Maps API script when the page loads
      window.onload = loadGoogleMapsScript;
    </script>
  </body>
  </html>
